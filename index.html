
<html lang="pt-BR">
<head>
    <link rel="stylesheet" href="D:\Projetos\JFNA\Front-end\pagina-kyvus\main.css">
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Cartão Gold - Benefícios</title>

    <!-- Firebase SDK -->
    <script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-firestore-compat.js"></script>
    <script>
        const firebaseConfig = {
        apiKey: "AIzaSyDp3IkvxJUUr37X5tmrejVf1mwnWSGXB6o",
        authDomain: "projetokyvus.firebaseapp.com",
        projectId: "projetokyvus",
        storageBucket: "projetokyvus.firebasestorage.app",
        messagingSenderId: "703360123160",
        appId: "1:703360123160:web:be51c60a7d3aaa510b5e6d",
        measurementId: "G-QD4JVP3V2Q"
        };
        firebase.initializeApp(firebaseConfig);
    </script>

</head>

<body>
    <div class="card">
        <div class="header">
            <div class="logo-section">
                <div class="logo">
                    <span class="logo-text">K</span>
                </div>
                <h1 class="gold-text">GOLD</h1>
            </div>
            <div class="conditions">
                <div class="conditions-main">R$ 9,90</div>
                <div class="conditions-sub">Por mês</div>
            </div>
        </div>

        <div class="benefits-list">
            <div class="benefit-item">
                <div class="checkmark"></div>
                <div class="benefit-text">Desconto manutenção corretiva</div>
            </div>
            <div class="benefit-item">
                <div class="checkmark"></div>
                <div class="benefit-text">Desconto na revisão do veículo</div>
            </div>
            <div class="benefit-item">
                <div class="checkmark"></div>
                <div class="benefit-text">Desconto em peças autógenas</div>
            </div>
            <div class="benefit-item">
                <div class="checkmark"></div>
                <div class="benefit-text">Desconto em serviços de estética</div>
            </div>
            <div class="benefit-item">
                <div class="checkmark"></div>
                <div class="benefit-text">Desconto em guinches e serviços de emergenciais</div>
            </div>
            <div class="benefit-item">
                <div class="checkmark"></div>
                <div class="benefit-text">Descontos em postos de combustível parceiros</div>
            </div>
            <div class="benefit-item">
                <div class="checkmark"></div>
                <div class="benefit-text">Descontos em aluguel de carros</div>
            </div>
            <div class="benefit-item">
                <div class="checkmark"></div>
                <div class="benefit-text">Contato direto com IA especialista</div>
            </div>
            <div class="benefit-item">
                <div class="checkmark"></div>
                <div class="benefit-text">Descontos em seguradoras parceiras</div>
            </div>
        </div>

        <button class="bottom-button">
            Adquira o Plano Gold
        </button>
    </div>

    <!-- Script de funcionamento -->
    <script>
        const urlParams = new URLSearchParams(window.location.search);
        const userId = urlParams.get("userId");
        const botao = document.querySelector('.bottom-button');

        botao.addEventListener('click', async () => {
        if (!userId) {
            alert('ID de usuário não encontrado. Acesse o link corretamente.');
            return;
        }

        botao.disabled = true;
        botao.textContent = 'Processando...';

        try {
            const db = firebase.firestore();
            const doc = await db.collection('users').doc(userId).get();

            if (!doc.exists) {
            alert('Usuário não encontrado.');
            botao.disabled = false;
            botao.textContent = 'Adquira o Plano Gold';
            return;
            }

            const userData = doc.data();
            const email = userData.email;

            if (!email) {
            alert('E-mail do usuário não está cadastrado.');
            botao.disabled = false;
            botao.textContent = 'Adquira o Plano Gold';
            return;
            }

            const hoje = new Date().toISOString().split('T')[0];

            const res = await fetch('https://sua-api.com/assinatura', {
            method: 'POST',
            headers: { 'Content-Type': 'application/json' },
            body: JSON.stringify({
                email: email,
                valor: 9.90,
                vencimento: hoje
            })
            });

            const result = await res.json();

            if (result.checkoutUrl) {
            window.location.href = result.checkoutUrl;
            } else {
            throw new Error(result.error || 'Erro inesperado ao gerar pagamento.');
            }

        } catch (err) {
            console.error(err);
            alert('Erro ao processar pagamento: ' + err.message);
            botao.disabled = false;
            botao.textContent = 'Adquira o Plano Gold';
        }
        });
    </script>

</body>
</html>
